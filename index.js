(function (cjs, an) {

var p; // shortcut to reference prototypes
var lib={};var ss={};var img={};
lib.ssMetadata = [
		{name:"An动画交互期末大作业_20235080906051_冯乐然_atlas_", frames: [[0,0,2000,1125]]},
		{name:"An动画交互期末大作业_20235080906051_冯乐然_atlas_2", frames: [[0,0,1206,1390]]},
		{name:"An动画交互期末大作业_20235080906051_冯乐然_atlas_3", frames: [[0,0,1220,1351]]},
		{name:"An动画交互期末大作业_20235080906051_冯乐然_atlas_4", frames: [[1026,1444,994,128],[1026,1574,994,128],[1026,1704,994,128],[0,1727,994,128],[1560,103,52,14],[1282,722,168,121],[0,0,1280,720],[1282,430,258,290],[0,722,1280,720],[0,1444,1024,281],[1542,430,90,103],[1452,722,111,142],[1282,0,276,428],[1560,0,82,101]]}
];


// symbols:



(lib.CachedBmp_7 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(0);
}).prototype = p = new cjs.Sprite();



(lib.CachedBmp_6 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(1);
}).prototype = p = new cjs.Sprite();



(lib.CachedBmp_5 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(2);
}).prototype = p = new cjs.Sprite();



(lib.CachedBmp_4 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(3);
}).prototype = p = new cjs.Sprite();



(lib.CachedBmp_8 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(4);
}).prototype = p = new cjs.Sprite();



(lib.CachedBmp_2 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(5);
}).prototype = p = new cjs.Sprite();



(lib.场景1 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(6);
}).prototype = p = new cjs.Sprite();



(lib.bag = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_3"]);
	this.gotoAndStop(0);
}).prototype = p = new cjs.Sprite();



(lib.bg3 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_"]);
	this.gotoAndStop(0);
}).prototype = p = new cjs.Sprite();



(lib.Dave = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(7);
}).prototype = p = new cjs.Sprite();



(lib.end = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(8);
}).prototype = p = new cjs.Sprite();



(lib.IMG_0570 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_2"]);
	this.gotoAndStop(0);
}).prototype = p = new cjs.Sprite();



(lib.IMG_0575 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(9);
}).prototype = p = new cjs.Sprite();



(lib.mermaid = function() {
	this.initialize(img.mermaid);
}).prototype = p = new cjs.Bitmap();
p.nominalBounds = new cjs.Rectangle(0,0,1728,2304);


(lib.note1 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(10);
}).prototype = p = new cjs.Sprite();



(lib.note2 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(11);
}).prototype = p = new cjs.Sprite();



(lib.note3 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(12);
}).prototype = p = new cjs.Sprite();



(lib.note4 = function() {
	this.initialize(ss["An动画交互期末大作业_20235080906051_冯乐然_atlas_4"]);
	this.gotoAndStop(13);
}).prototype = p = new cjs.Sprite();



(lib.海底 = function() {
	this.initialize(img.海底);
}).prototype = p = new cjs.Bitmap();
p.nominalBounds = new cjs.Rectangle(0,0,3543,5315);


(lib.首页 = function() {
	this.initialize(img.首页);
}).prototype = p = new cjs.Bitmap();
p.nominalBounds = new cjs.Rectangle(0,0,2972,1672);// helper functions:

function mc_symbol_clone() {
	var clone = this._cloneProps(new this.constructor(this.mode, this.startPosition, this.loop));
	clone.gotoAndStop(this.currentFrame);
	clone.paused = this.paused;
	clone.framerate = this.framerate;
	return clone;
}

function getMCSymbolPrototype(symbol, nominalBounds, frameBounds) {
	var prototype = cjs.extend(symbol, cjs.MovieClip);
	prototype.clone = mc_symbol_clone;
	prototype.nominalBounds = nominalBounds;
	prototype.frameBounds = frameBounds;
	return prototype;
	}


(lib.START = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.CachedBmp_4();
	this.instance.setTransform(-248.55,-32,0.5,0.5);

	this.instance_1 = new lib.CachedBmp_5();
	this.instance_1.setTransform(-248.55,-32,0.5,0.5);

	this.instance_2 = new lib.CachedBmp_6();
	this.instance_2.setTransform(-248.55,-32,0.5,0.5);

	this.instance_3 = new lib.CachedBmp_7();
	this.instance_3.setTransform(-248.55,-32,0.5,0.5);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.instance}]}).to({state:[{t:this.instance_1}]},1).to({state:[{t:this.instance_2}]},1).to({state:[{t:this.instance_3}]},1).wait(1));

	this._renderFirstFrame();

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(-248.5,-32,497,64);


(lib.Note4 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.note4();
	this.instance.setTransform(-41,-50.5);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.Note4, new cjs.Rectangle(-41,-50.5,82,101), null);


(lib.Note3 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.note3();
	this.instance.setTransform(-51.75,-80.25,0.375,0.375);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.Note3, new cjs.Rectangle(-51.7,-80.2,103.5,160.5), null);


(lib.Note2 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.note2();
	this.instance.setTransform(-55.5,-71);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.Note2, new cjs.Rectangle(-55.5,-71,111,142), null);


(lib.Note1 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.note1();
	this.instance.setTransform(-45,-51.5);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.Note1, new cjs.Rectangle(-45,-51.5,90,103), null);


(lib.mermaid_1 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.mermaid();
	this.instance.setTransform(-129.2,-172.25,0.1495,0.1495);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.mermaid_1, new cjs.Rectangle(-129.2,-172.2,258.4,344.5), null);


(lib.man1 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.IMG_0570();
	this.instance.setTransform(-137,-157,0.2265,0.2265);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(8).to({scaleX:0.2409,scaleY:0.2409,x:-145.25,y:-167.45},0).wait(91));

	this._renderFirstFrame();

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(-145.2,-167.4,290.5,334.9);


(lib.补间2 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.text = new cjs.Text("Let's go,Dave!You ready?", "57px 'Berlin Sans FB'", "#FFFFFF");
	this.text.lineHeight = 64;
	this.text.lineWidth = 619;
	this.text.alpha = 0.93725490;
	this.text.parent = this;
	this.text.setTransform(-309.3,-34.25);

	this.timeline.addTween(cjs.Tween.get(this.text).wait(1));

	this._renderFirstFrame();

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(-311.3,-36.2,622.6,72.5);


(lib.dive_btn = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.IMG_0575();
	this.instance.setTransform(-77,-21,0.1502,0.1502);

	this.instance_1 = new lib.CachedBmp_8();
	this.instance_1.setTransform(-4.05,2.4,0.5,0.5);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.instance_1},{t:this.instance,p:{scaleX:0.1502,scaleY:0.1502,x:-77,y:-21}}]}).to({state:[{t:this.instance_1},{t:this.instance,p:{scaleX:0.1717,scaleY:0.1717,x:-88,y:-24}}]},1).to({state:[{t:this.instance,p:{scaleX:0.1307,scaleY:0.1307,x:-66.9,y:-18.35}}]},1).to({state:[{t:this.instance,p:{scaleX:0.1419,scaleY:0.1419,x:-73,y:-20}}]},1).wait(1));

	this._renderFirstFrame();

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(-88,-24,175.8,48.3);


(lib.dave = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.Dave();
	this.instance.setTransform(-27.8,-31.25,0.2156,0.2156);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.dave, new cjs.Rectangle(-27.8,-31.2,55.6,62.5), null);


(lib.bag_1 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.bag();
	this.instance.setTransform(-109,-120.7,0.1787,0.1787);

	this.timeline.addTween(cjs.Tween.get(this.instance).wait(1));

	this._renderFirstFrame();

}).prototype = getMCSymbolPrototype(lib.bag_1, new cjs.Rectangle(-109,-120.7,218,241.4), null);


(lib.purchase1 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{});

	// 图层_1
	this.instance = new lib.补间2("synched",0);
	this.instance.setTransform(-858.9,-8.75);

	this.text = new cjs.Text("Find the legendery mermaid!", "57px 'Berlin Sans FB'", "#FFFFFF");
	this.text.lineHeight = 64;
	this.text.lineWidth = 692;
	this.text.parent = this;
	this.text.setTransform(-344,-38);
	this.text.shadow = new cjs.Shadow("rgba(0,204,255,1)",3,3,4);

	this.text_1 = new cjs.Text("Find the legendery mermaid!", "57px 'Berlin Sans FB'", "#FFFFFF");
	this.text_1.lineHeight = 64;
	this.text_1.lineWidth = 692;
	this.text_1.parent = this;
	this.text_1.setTransform(-344,-38);
	this.text_1.shadow = new cjs.Shadow("rgba(0,204,255,1)",3,3,4);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.instance}]}).to({state:[{t:this.instance}]},4).to({state:[{t:this.instance}]},10).to({state:[{t:this.text,p:{x:-344,y:-38,text:"Find the legendery mermaid!",font:"57px 'Berlin Sans FB'",textAlign:"",lineHeight:64.45,lineWidth:692}}]},43).to({state:[{t:this.text_1},{t:this.text,p:{x:72,y:-489.8,text:"游戏说明\n玩家用WASD键控制戴夫收集音符\n在30秒内把收集到的音符（位于背包\n中）用鼠标拖动到美人鱼身上，达到\n十个及以上即可通关。",font:"bold 57px 'DengXian'",textAlign:"center",lineHeight:76.35,lineWidth:934}}]},2).to({state:[{t:this.instance}]},469).wait(1));
	this.timeline.addTween(cjs.Tween.get(this.instance).to({x:0},4).wait(10).to({startPosition:0},0).to({_off:true},43).wait(471).to({_off:false},0).wait(1));

	this._renderFirstFrame();

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(-1170.2,-494.8,1720.3000000000002,545);


// stage content:
(lib.An动画交互期末大作业20235080906051冯乐然 = function(mode,startPosition,loop) {
	this.initialize(mode,startPosition,loop,{start:0,pretend:49,game:99,end:149});

	// timeline functions:
	this.frame_0 = function() {
		var root = this;
		root.stop();
		
		
		// 先停止之前可能正在放的任何声音
		createjs.Sound.stop();
		
		// 立即播放 bgm1
		
		createjs.Sound.play("bgm1", {loop: -1, volume: 1});
		
		
		
		root.start_btn.addEventListener("click", function(){
		    
		    // 点击后只需跳转，音乐会继续播放
		    // (直到下一场景的代码执行 stop 才会停)
		    this.gotoAndStop("pretend");   
		    
		}.bind(this));
	}
	this.frame_49 = function() {
		var root = this;
		root.stop();
		
		
		
		// 先停止上一场景的音乐 (防止重叠)
		createjs.Sound.stop();
		
		// 播放这一帧bgm2
		
		
		createjs.Sound.play("bgm2", {loop: -1, volume: 0.8});
		
		
		//按钮交互
		root.dive_btn.addEventListener("click", function(){
			
		    // 跳转到游戏场景
		    // (下一帧 "game" 的代码开头写了 stop()，所以这里不用管停止音乐的事)
		    this.gotoAndStop("game");   
		    
		}.bind(this));
	}
	this.frame_99 = function() {
		var root = this;
		// 进入此场景时，先停止之前声音
		createjs.Sound.stop(); 
		
		root.stop(); 
		
		//全局配置变量
		var daveSpeed = 15;        
		var mermaidHitRadius = 150; 
		var spawnRate = 30;        
		var w = canvas.width;
		var h = canvas.height;
		
		// 全局变量声明
		var currentScore, targetScore, gameTime, frameCount, isGameOver;
		var fallingContainer, inventoryContainer;
		var scoreText, timeText, resultText;
		var uiBg; 
		var bgmInstance; 
		var keyState = { KeyW: false, KeyS: false, KeyA: false, KeyD: false };
		
		
		
		function initGame() {
		    //重置变量
		    currentScore = 0;
		    targetScore = 10;
		    gameTime = 30;
		    frameCount = 0;
		    isGameOver = false;
		    
		    // 播放背景音乐
		    // 第一行已经 stop()过了，这里直接 play
		    if(bgmInstance) bgmInstance.stop(); 
		    bgmInstance = createjs.Sound.play("bgm", {loop: -1, volume: 0.5});
		
		    // 重置容器
		    if(fallingContainer) root.removeChild(fallingContainer);
		    if(inventoryContainer) root.removeChild(inventoryContainer);
		    
		    fallingContainer = new createjs.Container();
		    root.addChildAt(fallingContainer, 1); 
		    
		    inventoryContainer = new createjs.Container();
		    if (root.bag) {
		        inventoryContainer.x = root.bag.x;
		        inventoryContainer.y = root.bag.y;
		    } else {
		        inventoryContainer.x = 100;
		        inventoryContainer.y = h - 100;
		    }
		    root.addChild(inventoryContainer);
		    
		    //创建 UI 背景 (浅蓝色半透明
		    if(root.uiBg) root.removeChild(root.uiBg);
		    root.uiBg = new createjs.Shape();
		    root.uiBg.graphics.beginFill("#87CEEB") 
		                      .drawRoundRect(0, 0, 480, 60, 15);
		    root.uiBg.x = 20; 
		    root.uiBg.y = 20;
		    root.uiBg.alpha = 0.6; 
		    root.addChild(root.uiBg);
		
		    // 创建 UI 文本
		    if(scoreText) root.removeChild(scoreText);
		    scoreText = new createjs.Text("NUM: 0", "bold 40px Arial", "#FFFFFF");
		    scoreText.x = 40; scoreText.y = 30; 
		    scoreText.shadow = new createjs.Shadow("#000000", 2, 2, 4);
		    root.addChild(scoreText);
		    
		    if(timeText) root.removeChild(timeText);
		    timeText = new createjs.Text("TIME: 30", "bold 40px Arial", "#FFFFFF");
		    timeText.x = 260; timeText.y = 30; 
		    timeText.shadow = new createjs.Shadow("#000000", 2, 2, 4);
		    root.addChild(timeText);
		    
		    if(resultText) root.removeChild(resultText);
		    resultText = new createjs.Text("", "bold 80px Arial", "#FFFFFF");
		    resultText.textAlign = "center";
		    resultText.textBaseline = "middle";
		    resultText.x = w / 2; resultText.y = h / 2;
		    resultText.visible = false;
		    resultText.shadow = new createjs.Shadow("#000000", 3, 3, 5);
		    root.addChild(resultText);
		
		    //层级调整
		    if(root.dave) root.setChildIndex(root.dave, root.numChildren - 1);
		    if(root.mermaid) root.setChildIndex(root.mermaid, root.numChildren - 1);
		
		    // 启动监听
		    window.addEventListener("keydown", onKeyDown);
		    window.addEventListener("keyup", onKeyUp);
		    createjs.Ticker.addEventListener("tick", gameLoop);
		}
		
		// 清理场景 
		function cleanupScene() {
		    window.removeEventListener("keydown", onKeyDown);
		    window.removeEventListener("keyup", onKeyUp);
		    createjs.Ticker.removeEventListener("tick", gameLoop);
		    
		    if(bgmInstance) {
		        bgmInstance.stop();
		        bgmInstance = null;
		    }
		    
		    root.removeChild(fallingContainer);
		    root.removeChild(inventoryContainer);
		    root.removeChild(root.uiBg); 
		    root.removeChild(scoreText);
		    root.removeChild(timeText);
		    root.removeChild(resultText);
		    
		    fallingContainer = null;
		    inventoryContainer = null;
		}
		
		// 游戏结束逻辑
		function endGame(result) {
		    isGameOver = true;
		    
		    resultText.visible = true;
		    root.setChildIndex(resultText, root.numChildren - 1);
		    
		    if (result === "win") {
		        resultText.text = "SUCCESS!";
		        setTimeout(function() {
		            cleanupScene();
		            root.gotoAndStop("end"); 
		        }, 3000);
		    } else {
		        resultText.text = "GAME OVER";
		        setTimeout(function() {
		            cleanupScene();
		            initGame(); // 原地重玩
		        }, 3000);
		    }
		}
		
		//辅助功能
		
		function onKeyDown(e) { keyState[e.code] = true; }
		function onKeyUp(e) { keyState[e.code] = false; }
		
		function spawnNote() {
		    var noteIndex = Math.floor(Math.random() * 4) + 1; 
		    var noteClass = lib["Note" + noteIndex];
		    if (!noteClass) return;
		    
		    var note = new noteClass();
		    var padding = w * (1/6); 
		    var zoneWidth = w * (2/3);
		    note.x = padding + Math.random() * zoneWidth;
		    note.y = -50;
		    note.speedY = 3 + Math.random() * 4; 
		    note.initialX = note.x;
		    note.angle = Math.random() * Math.PI * 2;
		    fallingContainer.addChild(note);
		}
		
		function collectNoteToBag(note) {
		    fallingContainer.removeChild(note);
		    var newNote = new note.constructor(); 
		    inventoryContainer.addChild(newNote);
		    newNote.x = (Math.random() * 60) - 30;
		    newNote.y = (Math.random() * 40) - 20;
		    newNote.scaleX = newNote.scaleY = 0.6;
		    newNote.cursor = "pointer";
		    enableDrag(newNote);
		}
		
		function enableDrag(item) {
		    item.on("mousedown", function(evt) {
		        var globalPt = inventoryContainer.localToGlobal(this.x, this.y);
		        this.offset = {x: globalPt.x - evt.stageX, y: globalPt.y - evt.stageY};
		        inventoryContainer.setChildIndex(this, inventoryContainer.numChildren - 1);
		    });
		
		    item.on("pressmove", function(evt) {
		        var realX = evt.stageX + this.offset.x;
		        var realY = evt.stageY + this.offset.y;
		        var localPt = inventoryContainer.globalToLocal(realX, realY);
		        this.x = localPt.x;
		        this.y = localPt.y;
		    });
		
		    item.on("pressup", function(evt) {
		        var noteGlobal = inventoryContainer.localToGlobal(this.x, this.y);
		        var mermaidGlobal = root.mermaid.localToGlobal(0, 0); 
		        var dist = Math.sqrt(Math.pow(noteGlobal.x - mermaidGlobal.x, 2) + Math.pow(noteGlobal.y - mermaidGlobal.y, 2));
		        
		        if (dist < mermaidHitRadius) {
		            inventoryContainer.removeChild(this); 
		            currentScore += 1;
		            scoreText.text = "NUM: " + currentScore; 
		            if (currentScore >= targetScore) endGame("win");
		        } else {
		            createjs.Tween.get(this).to({x: (Math.random()*60)-30, y: (Math.random()*40)-20}, 300);
		        }
		    });
		}
		
		// 主循环
		function gameLoop(event) {
		    if (isGameOver) return;
		    
		    gameTime -= event.delta / 1000;
		    if (gameTime < 0) gameTime = 0;
		    timeText.text = "TIME: " + Math.ceil(gameTime);
		
		    if (gameTime <= 0) {
		        if(currentScore < targetScore) endGame("lose");
		        return;
		    }
		
		    // Dave 移动
		    if (keyState["KeyW"] || keyState["Keyw"]) root.dave.y -= daveSpeed;
		    if (keyState["KeyS"] || keyState["Keys"]) root.dave.y += daveSpeed;
		    if (keyState["KeyA"] || keyState["Keya"]) {
		        root.dave.x -= daveSpeed;
		        root.dave.scaleX = 1;
		    }
		    if (keyState["KeyD"] || keyState["Keyd"]) {
		        root.dave.x += daveSpeed;
		        root.dave.scaleX = -1;
		    }
		    root.dave.x = Math.max(0, Math.min(w, root.dave.x));
		    root.dave.y = Math.max(0, Math.min(h, root.dave.y));
		
		    // 生成与掉落
		    frameCount++;
		    if (frameCount % spawnRate === 0) spawnNote();
		
		    var children = fallingContainer.children.slice();
		    for (var i = 0; i < children.length; i++) {
		        var note = children[i];
		        note.y += note.speedY;
		        note.angle += 0.1;
		        note.x = note.initialX + Math.sin(note.angle) * 30;
		        
		        var dx = note.x - root.dave.x;
		        var dy = note.y - root.dave.y;
		        if (Math.sqrt(dx*dx + dy*dy) < 60) {
		            collectNoteToBag(note);
		            continue;
		        }
		        if (note.y > h + 50) fallingContainer.removeChild(note);
		    }
		}
		
		// 启动游戏
		initGame();
	}
	this.frame_149 = function() {
		var root = this;
		root.stop(); // 停止画面，防止循环播放
		
		
		//先停止上一场景的音乐
		createjs.Sound.stop();
		
		// 播放结局音乐
		
		createjs.Sound.play("bgm3", {loop: -1, volume: 1});
	}

	// actions tween:
	this.timeline.addTween(cjs.Tween.get(this).call(this.frame_0).wait(49).call(this.frame_49).wait(50).call(this.frame_99).wait(50).call(this.frame_149).wait(51));

	// 图层_2
	this.start_btn = new lib.START();
	this.start_btn.setTransform(625.35,587.75);
	new cjs.ButtonHelper(this.start_btn, 0, 1, 2, false, new lib.START(), 3);

	this.dive_btn = new lib.dive_btn();
	this.dive_btn.setTransform(613.9,542.35);
	new cjs.ButtonHelper(this.dive_btn, 0, 1, 2, false, new lib.dive_btn(), 3);

	this.bag = new lib.bag_1();
	this.bag.setTransform(117,542.7,0.8094,0.8094);

	this.note3 = new lib.Note3();
	this.note3.setTransform(480,-109.3);

	this.note2 = new lib.Note2();
	this.note2.setTransform(676.05,-100.05);

	this.note1 = new lib.Note1();
	this.note1.setTransform(216.2,-64.65);

	this.note4 = new lib.Note4();
	this.note4.setTransform(349.9,-106.6);

	this.mermaid = new lib.mermaid_1();
	this.mermaid.setTransform(1113.2,454.25,0.6982,0.6982,0,0,0,-21,-16);

	this.dave = new lib.dave();
	this.dave.setTransform(355.8,401.25);

	this.text = new cjs.Text("", "68px 'BerlinSansFB-Reg'", "#FFFFFF");
	this.text.lineHeight = 76;
	this.text.lineWidth = 132;
	this.text.parent = this;
	this.text.setTransform(574.15,379.25);
	this.text.shadow = new cjs.Shadow("rgba(0,255,255,1)",0,0,4);

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.start_btn}]}).to({state:[{t:this.dive_btn}]},49).to({state:[{t:this.dave},{t:this.mermaid},{t:this.note4},{t:this.note1},{t:this.note2},{t:this.note3},{t:this.bag}]},50).to({state:[{t:this.text}]},50).wait(51));

	// bg1
	this.instance = new lib.海底();
	this.instance.setTransform(0,-205,0.3625,0.174);

	this.instance_1 = new lib.首页();
	this.instance_1.setTransform(0,-5,0.4334,0.4334);

	this.instance_2 = new lib.CachedBmp_2();
	this.instance_2.setTransform(840.5,606.6,0.5,0.5);

	this.instance_3 = new lib.purchase1();
	this.instance_3.setTransform(547.7,642.85);

	this.instance_4 = new lib.man1();
	this.instance_4.setTransform(1009.25,547.45);

	this.instance_5 = new lib.场景1();
	this.instance_5.setTransform(-8,-4,1.0125,1.0125);

	this.instance_6 = new lib.bg3();
	this.instance_6.setTransform(0,-4,0.6438,0.6438);

	this.instance_7 = new lib.end();

	this.timeline.addTween(cjs.Tween.get({}).to({state:[{t:this.instance_2},{t:this.instance_1},{t:this.instance}]}).to({state:[{t:this.instance_2},{t:this.instance_1},{t:this.instance},{t:this.instance_5},{t:this.instance_4},{t:this.instance_3}]},49).to({state:[{t:this.instance_6}]},50).to({state:[{t:this.instance_7}]},50).wait(51));

	this._renderFirstFrame();

}).prototype = p = new cjs.MovieClip();
p.nominalBounds = new cjs.Rectangle(17.5,155,1270.5,570);
// library properties:
lib.properties = {
	id: '3322EA8BF0D4804E94BA192E9DF6F4E9',
	width: 1280,
	height: 720,
	fps: 30,
	color: "#CCCCCC",
	opacity: 1.00,
	manifest: [
		{src:"images/mermaid.png?1766988797801", id:"mermaid"},
		{src:"images/海底_.png?1766988797801", id:"海底"},
		{src:"images/首页_.jpg?1766988797801", id:"首页"},
		{src:"images/An动画交互期末大作业_20235080906051_冯乐然_atlas_.png?1766988797764", id:"An动画交互期末大作业_20235080906051_冯乐然_atlas_"},
		{src:"images/An动画交互期末大作业_20235080906051_冯乐然_atlas_2.png?1766988797764", id:"An动画交互期末大作业_20235080906051_冯乐然_atlas_2"},
		{src:"images/An动画交互期末大作业_20235080906051_冯乐然_atlas_3.png?1766988797764", id:"An动画交互期末大作业_20235080906051_冯乐然_atlas_3"},
		{src:"images/An动画交互期末大作业_20235080906051_冯乐然_atlas_4.png?1766988797765", id:"An动画交互期末大作业_20235080906051_冯乐然_atlas_4"},
		{src:"sounds/bgm3.mp3?1766988797801", id:"bgm3"},
		{src:"sounds/bgm1.mp3?1766988797801", id:"bgm1"},
		{src:"sounds/bgm.mp3?1766988797801", id:"bgm"},
		{src:"sounds/bgm2.mp3?1766988797801", id:"bgm2"}
	],
	preloads: []
};



// bootstrap callback support:

(lib.Stage = function(canvas) {
	createjs.Stage.call(this, canvas);
}).prototype = p = new createjs.StageGL();

p.setAutoPlay = function(autoPlay) {
	this.tickEnabled = autoPlay;
}
p.play = function() { this.tickEnabled = true; this.getChildAt(0).gotoAndPlay(this.getTimelinePosition()) }
p.stop = function(ms) { if(ms) this.seek(ms); this.tickEnabled = false; }
p.seek = function(ms) { this.tickEnabled = true; this.getChildAt(0).gotoAndStop(lib.properties.fps * ms / 1000); }
p.getDuration = function() { return this.getChildAt(0).totalFrames / lib.properties.fps * 1000; }

p.getTimelinePosition = function() { return this.getChildAt(0).currentFrame / lib.properties.fps * 1000; }

an.bootcompsLoaded = an.bootcompsLoaded || [];
if(!an.bootstrapListeners) {
	an.bootstrapListeners=[];
}

an.bootstrapCallback=function(fnCallback) {
	an.bootstrapListeners.push(fnCallback);
	if(an.bootcompsLoaded.length > 0) {
		for(var i=0; i<an.bootcompsLoaded.length; ++i) {
			fnCallback(an.bootcompsLoaded[i]);
		}
	}
};

an.compositions = an.compositions || {};
an.compositions['3322EA8BF0D4804E94BA192E9DF6F4E9'] = {
	getStage: function() { return exportRoot.stage; },
	getLibrary: function() { return lib; },
	getSpriteSheet: function() { return ss; },
	getImages: function() { return img; }
};

an.compositionLoaded = function(id) {
	an.bootcompsLoaded.push(id);
	for(var j=0; j<an.bootstrapListeners.length; j++) {
		an.bootstrapListeners[j](id);
	}
}

an.getComposition = function(id) {
	return an.compositions[id];
}


an.makeResponsive = function(isResp, respDim, isScale, scaleType, domContainers) {		
	var lastW, lastH, lastS=1;		
	window.addEventListener('resize', resizeCanvas);		
	resizeCanvas();		
	function resizeCanvas() {			
		var w = lib.properties.width, h = lib.properties.height;			
		var iw = window.innerWidth, ih=window.innerHeight;			
		var pRatio = window.devicePixelRatio || 1, xRatio=iw/w, yRatio=ih/h, sRatio=1;			
		if(isResp) {                
			if((respDim=='width'&&lastW==iw) || (respDim=='height'&&lastH==ih)) {                    
				sRatio = lastS;                
			}				
			else if(!isScale) {					
				if(iw<w || ih<h)						
					sRatio = Math.min(xRatio, yRatio);				
			}				
			else if(scaleType==1) {					
				sRatio = Math.min(xRatio, yRatio);				
			}				
			else if(scaleType==2) {					
				sRatio = Math.max(xRatio, yRatio);				
			}			
		}			
		domContainers[0].width = w * pRatio * sRatio;			
		domContainers[0].height = h * pRatio * sRatio;			
		domContainers.forEach(function(container) {				
			container.style.width = w * sRatio + 'px';				
			container.style.height = h * sRatio + 'px';			
		});			
		stage.scaleX = pRatio*sRatio;			
		stage.scaleY = pRatio*sRatio;			
		lastW = iw; lastH = ih; lastS = sRatio;            
		stage.tickOnUpdate = false;            
		stage.update();            
		stage.tickOnUpdate = true;		
	}
}


})(createjs = createjs||{}, AdobeAn = AdobeAn||{});
var createjs, AdobeAn;